<script src="https://cdn.jsdelivr.net/gh/netizenorg/netnet-standard-library/build/nn.min.js"></script>
<script>
/* global nn */

const EMOJI_FEELINGS = ["ðŸ¥¶", "ðŸ¤§", "ðŸ«¤", "â˜ºï¸", "ðŸ˜", "ðŸ¤©", "ðŸ¥µ"]

function sleep (ms) {
  return new Promise(resolve => setTimeout(resolve, ms))
}

async function get_location_forecast (lat, lng) {
  const pointURL = `https://api.weather.gov/points/${lat},${lng}`
  const nws_point = await fetch(pointURL)
  const pointData = await nws_point.json()
  
  const forecasthrURL = pointData.properties.forecastHourly
  const nws_forecast = await fetch(forecasthrURL)
  
  const forecast = await nws_forecast.json()
  
  // const temp = forecast.properties.periods[0].temperature
  // const unit = forecast.properties.periods[0].temperatureUnit
  
  // console.log(`The current temperature is ${temp}${unit}`)
  // console.log(forecast.properties.periods.length)
  return forecast
}
  
function determine_mood (temperature) {
  if (temperature <= 32 + 1.8 * 5) {
    return EMOJI_FEELINGS[0]
  }
  if (32 + 1.8 * 5 < temperature <= 32 + 1.8 * 10) {
    return EMOJI_FEELINGS[1]
  }
  if (32 + 1.8 * 10 < temperature <= 32 + 1.8 * 15) {
    return EMOJI_FEELINGS[2]
  }
  if (32 + 1.8 * 15 < temperature <= 32 + 1.8 * 20) {
    return EMOJI_FEELINGS[3]
  }
  if (32 + 1.8 * 20 < temperature <= 32 + 1.8 * 25) {
    return EMOJI_FEELINGS[4]
  }
  if (32 + 1.8 * 25 < temperature <= 32 + 1.8 * 30) {
    return EMOJI_FEELINGS[5]
  }
  if (32 + 1.8 * 30 < temperature) {
    return EMOJI_FEELINGS[6]
  }
}

async function draw_temp_emojis (periods) {
  for (let i = 0; i < periods.length; i++) {
    for (let j = 0; j < 10; j++) {
      nn.create("span")
        .content(determine_mood(periods[i].temperature))
        .css({
              fontSize: "15px",
              position: "absolute",
              left: nn.random(0, nn.width),
              top: nn.random((i / periods.length) * nn.height, (i + 1) / periods.length * nn.height)
          })
        .addTo("body")
    }
  }
}

async function main () {
  const my_gps = await nn.askForGPS()
  const forecast = await get_location_forecast(my_gps.lat, my_gps.lng)
  const periods = forecast.properties.periods
  draw_temp_emojis(periods)
}

main()


</script>